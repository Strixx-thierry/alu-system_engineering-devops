#!/usr/bin/env bash

# This script configures a new Ubuntu machine to install and configure Nginx and ensure it listens on port 80.

# Update and upgrade the system
sudo apt-get update -y
sudo apt-get upgrade -y

# Install Nginx
sudo apt-get install -y nginx

# Start and enable Nginx to run on boot
sudo systemctl start nginx
sudo systemctl enable nginx

# Ensure Nginx is listening on port 80
sudo ufw allow 'Nginx HTTP'

# Check the status of Nginx service
systemctl status nginx

# Configure Nginx to listen on IPv4 and IPv6 (default behavior)
sudo sed -i 's/# server_name _;/server_name _;/g' /etc/nginx/sites-available/default

# Test the Nginx configuration for any syntax errors
sudo nginx -t

# Reload Nginx to apply the changes
sudo systemctl reload nginx

# Output a success message
echo "Nginx is installed and configured to listen on port 80."

# Display the listening status of Nginx (will not include web-01 or web-02)
sudo ss -tulnp | grep ':80'
